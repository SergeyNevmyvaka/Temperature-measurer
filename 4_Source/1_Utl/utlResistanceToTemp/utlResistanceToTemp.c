#include "utlResistanceToTemp.h"
#include "si_toolchain.h"

#define RTT_R_TABLE_SIZE     126

#define RTT_REAL_TEMP_MIN      195652  // -40 // 65000 //-19

// MURATA NTHCG83 TERMISTOR 10K
SI_SEGMENT_VARIABLE(Murata_R_Table[RTT_R_TABLE_SIZE], uint16_t,  SI_SEG_XDATA) = {

//    68236,      //-20
//    64990,      //-19   // если значение сопротивления больше -> режим Err
//    61919,      //-18
//    59011,      //-17
//    56257,      //-16
//    53649,      //-15
//    51177,      //-14
//    48834,      //-13
//    46613,      //-12
//    44505,      //-11
//    42506,      //-10
//    40599,      //-9
//    38790,      //-8
//    37072,      //-7
//    35441,      //-6
//    33892,      //-5
//    32419,      //-4
//    31020,      //-3
//    29689,      //-2
//    28423,      //-1
    27218,      // 0       
    26076,      // 1    
    24987,      // 2      
    23950,      // 3     
    22962,      // 4        
    22021,      // 5        
    21123,      // 6        
    20266,      // 7      
    19449,      // 8         
    18669,      // 9   
    17925,      // 10        
    17213,      // 11        
    16534,      // 12         
    15885,      // 13        
    15265,      // 14      
    14673,      // 15       
    14107,      // 16       
    13566,      // 17       
    13048,      // 18       
    12554,      // 19       
    12080,      // 20      
    11628,      // 21       
    11194,      // 22       
    10779,      // 23       
    10381,      // 24       
    10000,      // 25      
    9634,       // 26      
    9283,       // 27        
    8947,       // 28      
    8624,       // 29        
    8314,       // 30    
    8018,       // 31        
    7733,       // 32        
    7460,       // 33        
    7199,       // 34       
    6947,       // 35       
    6706,       // 36      
    6475,       // 37   
    6252,       // 38        
    6039,       // 39       
    5833,       // 40       
    5635,       // 41        
    5445,       // 42        
    5262,       // 43      
    5086,       // 44       
    4916,       // 45      
    4753,       // 46       
    4597,       // 47        
    4446,       // 48       
    4300,       // 49       
    4160,       // 50      
    4026,       // 51        
    3896,       // 52       
    3771,       // 53       
    3651,       // 54       
    3535,       // 55       
    3423,       // 56        
    3315,       // 57       
    3211,       // 58         
    3111,       // 59        
    3014,       // 60      
    2922,       // 61       
    2833,       // 62        
    2748,       // 63        
    2665,       // 64       
    2586,       // 65         
    2509,       // 66        
    2435,       // 67      
    2363,       // 68       
    2294,       // 69       
    2227,       // 70       
    2162,       // 71       
    2100,       // 72        
    2039,       // 73      
    1981,       // 74        
    1924,       // 75         
    1869,       // 76         
    1817,       // 77       
    1765,       // 78        
    1716,       // 79        
    1668,       // 80        
    1622,       // 81        
    1577,       // 82       
    1534,       // 83        
    1492,       // 84        
    1452,       // 85        
    1412,       // 86       
    1374,       // 87        
    1338,       // 88      
    1302,       // 89       
    1268,       // 90       
    1234,       // 91      
    1201,       // 92      
    1170,       // 93      
    1139,       // 94       
    1109,       // 95        
    1080,       // 96       
    1052,       // 97       
    1025,       // 98         
    999,        // 99        
    973,        // 100      
    949,        // 101       
    925,        // 102      
    902,        // 103     
    879,        // 104      
    858,        // 105      
    836,        // 106    
    816,        // 107       
    796,        // 108    
    776,        // 109    
    758,        // 110      
    739,        // 111    
    721,        // 112    
    704,        // 113     
    687,        // 114    
    671,        // 115
    655,        // 116
    640,        // 117
    625,        // 118
    610,        // 119
    596,        // 120
    582,        // 121
    569,        // 122
    556,        // 123
    543,        // 124
    531         // 125

};


float utlResistanceToTemp_Convert (unsigned long resistance)
{
    unsigned char   i;
    unsigned short  R1, R2;
    char            t1, t2;
    float           t = 0;

    if ((resistance >= Murata_R_Table[RTT_R_TABLE_SIZE-1/*9*/]) && (resistance <= Murata_R_Table[0]))
    {

        for (i = 0; i < RTT_R_TABLE_SIZE; i++)
        {
            if (resistance >= Murata_R_Table[i])
            {

                t1 = i;
                t2 = t1  - 1;
                R1 = Murata_R_Table[i];
                R2 = Murata_R_Table[i-1];
                t  = (float)((R2 * t1 - R1 * t2) - (t1 - t2) * resistance);
                t  = t / (float)(R2 - R1);                
                break;
            }
        }
    }
    //else if ((resistance < Murata_R_Table[RTT_R_TABLE_SIZE-1]) || (resistance > Murata_R_Table[0]))
    else if ((resistance < Murata_R_Table[RTT_R_TABLE_SIZE-1]) || (resistance > RTT_REAL_TEMP_MIN))
    {
    	t = UTL_RESISTANCE_TO_TEMP_ERROR_VALUE;
    }


    return t;  

}


